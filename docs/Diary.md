/**
 * @file: Diary.md
 * @description: Подробный инженерный дневник проекта: решения, наблюдения, проблемы.
 * @dependencies: docs/Project.md, docs/Tasktracker.md
 * @created: 2025-09-13
 */

## 2025-09-13

### Наблюдения
- В репозитории есть `server.js`, `pattern1.pdf`, базовые тестовые скрипты; добавлена папка `docs/` и файл правил `/.cursorrules`.
- Требование: значения должны попадать в шаблон справа от меток `msr:`, `n:`, `sh:`, `mchr:` и второе вхождение `msr:` (секундный расход).
- Для устойчивой производительности целесообразно кэшировать загруженный шаблон PDF и координаты меток.
- Входные данные должны проходить строгую валидацию (типы/диапазоны), числовые значения — нормализацию и округление.

### Решения
- На V0 выбран подход рендеринга по заранее зафиксированным координатам (anchors) с конфигом `config/markers.json`; автопоиск текста меток запланирован как V1.
- Формулы расчёта: `hourly = 3.9 * daily / 24`, `secondly = hourly / 3.6`; округление до 2 знаков (конфигурируемо).
- API: `POST /generate-pdf` с телом JSON; ответ — `application/pdf` (attachment). Ошибки — в едином формате.
- Обновлён `docs/Project.md` (архитектура, НФТ: CORS, rate limit, ограничение размера запроса, кэширование шаблона).

### Проблемы
- Точные координаты меток в `pattern1.pdf` ещё не промерены; требуется инструментальная разметка и фиксация в `config/markers.json`.
- Не зафиксированы локальные правила форматирования чисел (запятая/точка) — нужно подтверждение требований.
- Не выбран шрифт для `pdf-lib` (встроенный стандартный vs кастомный) — влияет на визуальное совпадение с шаблоном.

## 2025-09-13 (продолжение)

### Наблюдения
- Фронтенд не обрабатывал JSON-ответы с ошибками от сервера, что приводило к неинформативным сообщениям пользователю.
- Попытка использовать fontkit для кастомных TTF шрифтов не удалась из-за изменений в API pdf-lib.

### Решения
- Обновлен `script.js` для корректной обработки JSON-ответов при ошибках (код 400).
- Добавлено предупреждение на главной странице о временной недоступности кириллицы.
- Принято решение использовать только стандартные шрифты с валидацией на кириллицу до полной интеграции fontkit.

### Проблемы
- Интеграция fontkit требует дополнительного исследования API pdf-lib для корректной регистрации.
- Координаты меток в `config/markers.json` все еще являются заглушками и требуют калибровки под реальный шаблон.

