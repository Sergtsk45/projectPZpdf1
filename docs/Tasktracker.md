/**
 * @file: Tasktracker.md
 * @description: Трекер задач проекта на основе Project.md с приоритетами и зависимостями.
 * @dependencies: docs/Project.md
 * @created: 2025-09-13
 */

## Задача: Создать папку docs и базовые документы
- **Статус**: Завершена
- **Приоритет**: Средний
- **Описание**: Создание структуры документации и файла правил для стабильного процесса разработки.
- **Шаги выполнения**:
  - [x] Создать папку docs и файлы Project.md, Tasktracker.md, Diary.md, qa.md, changelog.md
  - [x] Создать /.cursorrules с правилами репозитория
  - [x] Заполнить Project.md первичным содержимым
- **Зависимости**: [нет]

## Задача: Гибридная архитектура для пользовательских шаблонов
- **Статус**: Завершена
- **Приоритет**: Критический
- **Описание**: Реализация гибридного подхода (авто-детект + кэш координат + AcroForm) для поддержки пользовательских PDF шаблонов.
- **Шаги выполнения**:
  - [x] Создать структуру backend/ с модульной архитектурой
  - [x] Добавить зависимости: cors, multer, pdfjs-dist
  - [x] Реализовать схему манифеста Manifest.js
  - [x] Создать API эндпоинты для загрузки и генерации
  - [x] Реализовать авто-детекцию меток с pdfjs-dist
  - [x] Добавить поддержку AcroForm полей
  - [x] Обработать дубликаты меток msr: через привязки
- **Зависимости**: [нет]

## Задача: Реализовать API POST /generate-pdf
- **Статус**: Завершена
- **Приоритет**: Критический
- **Описание**: Принять входные данные, выполнить расчёты, сгенерировать PDF и вернуть как вложение.
- **Шаги выполнения**:
  - [x] Уточнить и зафиксировать контракт запроса/ответа (docs/Project.md)
  - [x] Реализовать эндпоинт в backend/app.js
  - [x] Добавить валидацию входных данных и обработку ошибок
  - [x] Написать интеграционный тест /generate-pdf
- **Зависимости**: [Реализовать модуль расчётов], [Заполнение PDF относительно меток]

## Задача: Реализовать модуль расчётов (часовой и секундный расход)
- **Статус**: Не начата
- **Приоритет**: Высокий
- **Описание**: Реализовать формулы и округление, экспортируемые функции.
- **Шаги выполнения**:
  - [ ] Функция hourly = 3.9 * daily / 24
  - [ ] Функция secondly = hourly / 3.6
  - [ ] Конфигурируемое округление и локализация
  - [ ] Юнит‑тесты
- **Зависимости**: [нет]

## Задача: Заполнение PDF относительно меток
- **Статус**: Не начата
- **Приоритет**: Критический
- **Описание**: Разместить значения справа от «msr:», «n:», «sh:», «mchr:», «msr: (secondly)» в pattern1.pdf.
- **Шаги выполнения**:
  - [ ] Добавить pdf-lib в зависимости
  - [ ] Реализовать рендер значений по координатам (anchors)
  - [ ] Выбрать/эмбедить шрифт и размер
  - [ ] Написать тест с фикстурой PDF
- **Зависимости**: [Подготовить config/markers.json]

## Задача: Подготовить config/markers.json (координаты меток)
- **Статус**: Не начата
- **Приоритет**: Высокий
- **Описание**: Зафиксировать координаты страниц/меток и отступы dx/dy для позиционирования справа от маркеров.
- **Шаги выполнения**:
  - [ ] Создать config/markers.json
  - [ ] Внести координаты для msr_daily, n, sh, mchr, msr_secondly
  - [ ] Ввести версионирование шаблона (templateVersion)
- **Зависимости**: [Заполнение PDF относительно меток]

## Задача: Безопасность и ограничения (валидация, CORS, rate limit)
- **Статус**: Не начата
- **Приоритет**: Высокий
- **Описание**: Предотвратить недопустимые входные данные и злоупотребления.
- **Шаги выполнения**:
  - [ ] Схема валидации входных данных (тип/диапазон/длина)
  - [ ] CORS для доверенных источников
  - [ ] Rate limiting по IP
  - [ ] Ограничение размера тела запроса
- **Зависимости**: [Реализовать API POST /generate-pdf]

## Задача: Frontend форма и интеграция с API
- **Статус**: Не начата
- **Приоритет**: Средний
- **Описание**: HTML/JS форма, отправка данных на бэкенд, загрузка PDF.
- **Шаги выполнения**:
  - [ ] Создать форму с полями dailyConsumption, pumpModel, projectCode
  - [ ] Кнопки «Рассчитать», «Сгенерировать PDF»
  - [ ] Валидация на клиенте
  - [ ] Интеграция с /generate-pdf и загрузка файла
- **Зависимости**: [Реализовать API POST /generate-pdf]

## Задача: Логирование и обработка ошибок
- **Статус**: Не начата
- **Приоритет**: Средний
- **Описание**: Единый формат ошибок, уровни логирования, трассировка проблем.
- **Шаги выполнения**:
  - [ ] Ввести middleware обработки ошибок
  - [ ] Формат { code, message, details? }
  - [ ] Логирование info/warn/error
- **Зависимости**: [Реализовать API POST /generate-pdf]

## Задача: Тестирование (unit + integration)
- **Статус**: Не начата
- **Приоритет**: Высокий
- **Описание**: Покрыть расчёты, рендер PDF и E2E.
- **Шаги выполнения**:
  - [ ] Юнит‑тесты функций расчёта
  - [ ] Тесты маппинга координат и рендера текста
  - [ ] Интеграционный тест /generate-pdf
- **Зависимости**: [Реализовать модуль расчётов], [Заполнение PDF относительно меток], [Реализовать API POST /generate-pdf]

## Задача: Настроить линтеры и pre-commit hooks
- **Статус**: Не начата
- **Приоритет**: Средний
- **Описание**: Единый стиль кода, предотвращение мусора в репозитории.
- **Шаги выполнения**:
  - [ ] ESLint + Prettier конфигурация
  - [ ] Husky + lint-staged pre-commit
- **Зависимости**: [нет]

## Задача: Настроить переменные окружения и конфигурацию
- **Статус**: Не начата
- **Приоритет**: Средний
- **Описание**: Параметризация порта, CORS, rate limit, локали.
- **Шаги выполнения**:
  - [ ] .env и загрузка конфигурации
  - [ ] Документация параметров в Project.md
- **Зависимости**: [нет]

## Задача: Подготовить деплой (production)
- **Статус**: Не начата
- **Приоритет**: Низкий
- **Описание**: PM2, переменные окружения, документация запуска.
- **Шаги выполнения**:
  - [ ] PM2/ecosystem.config.js
  - [ ] Гайд по деплою в README
- **Зависимости**: [Безопасность и ограничения], [Реализовать API POST /generate-pdf]
/**
 * @file: Tasktracker.md
 * @description: Трекер задач проекта на основе Project.md с приоритетами и зависимостями.
 * @dependencies: docs/Project.md
 * @created: 2025-09-13
 */

## Задача: Создать папку docs и базовые документы
- **Статус**: Завершена
- **Приоритет**: Средний
- **Описание**: Создание структуры документации и файла правил для стабильного процесса разработки.
- **Шаги выполнения**:
  - [x] Создать папку docs и файлы Project.md, Tasktracker.md, Diary.md, qa.md, changelog.md
  - [x] Создать /.cursorrules с правилами репозитория
  - [x] Заполнить Project.md первичным содержимым
- **Зависимости**: нет

## Задача: Починить взаимодействие с Git/GitHub и удалить мусорные файлы
- **Статус**: В процессе
- **Приоритет**: Высокий
- **Описание**: Отключить pager, проверить алиасы/путь git, очистить мусорные файлы, добавить безопасный скрипт пуша и привести git-скрипты к безопасному виду.
- **Шаги выполнения**:
  - [x] Добавить `scripts/git_save_safe.sh` (безопасный пуш)
  - [x] Отключить pager в локальном конфиге/скрипте
  - [x] Очистить мусорные файлы, созданные неверными командами
  - [ ] Зафиксировать изменения и отправить в текущую ветку
  - [ ] Проверить историю коммитов на origin
- **Зависимости**: [нет]

## Задача: Реализовать API POST /generate-pdf
- **Статус**: Не начата
- **Приоритет**: Критический
- **Описание**: Принять входные данные, выполнить расчёты, сгенерировать PDF и вернуть как вложение.
- **Шаги выполнения**:
  - [ ] Определить контракт запроса/ответа в docs/Project.md (уточнить поля)
  - [ ] Реализовать эндпоинт в server.js
  - [ ] Добавить валидацию входных данных и обработку ошибок
  - [ ] Написать интеграционный тест /generate-pdf
- **Зависимости**: «Реализовать модуль расчётов», «Заполнение PDF относительно меток»

## Задача: Реализовать модуль расчётов (часовой и секундный расход)
- **Статус**: Завершена
- **Приоритет**: Высокий
- **Описание**: Реализовать формулы и округление, экспортируемые функции.
- **Шаги выполнения**:
  - [x] Функция hourly = 3.9 * daily / 24
  - [x] Функция secondly = hourly / 3.6
  - [x] Конфигурируемое округление и локализация
  - [x] Юнит‑тесты
- **Зависимости**: нет

## Задача: Заполнение PDF относительно меток
- **Статус**: Не начата
- **Приоритет**: Критический
- **Описание**: Разместить значения справа от «msr:», «n:», «sh:», «mchr:», «msr: (secondly)» в pattern1.pdf.
- **Шаги выполнения**:
  - [ ] Добавить pdf-lib в зависимости
  - [ ] Реализовать рендер значений по координатам (anchors)
  - [ ] Выбрать/эмбедить шрифт и размер
  - [ ] Написать тест с фикстурой PDF
- **Зависимости**: «Подготовить config/markers.json»

## Задача: Подготовить config/markers.json (координаты меток)
- **Статус**: Не начата
- **Приоритет**: Высокий
- **Описание**: Зафиксировать координаты страниц/меток и отступы dx/dy для позиционирования справа от маркеров.
- **Шаги выполнения**:
  - [ ] Создать config/markers.json
  - [ ] Внести координаты для msr_daily, n, sh, mchr, msr_secondly
  - [ ] Ввести версионирование шаблона (например, templateVersion)
- **Зависимости**: «Заполнение PDF относительно меток»

## Задача: Безопасность и ограничения (валидация, CORS, rate limit)
- **Статус**: Не начата
- **Приоритет**: Высокий
- **Описание**: Предотвратить недопустимые входные данные и злоупотребления.
- **Шаги выполнения**:
  - [ ] Схема валидации входных данных (тип/диапазон/длина)
  - [ ] CORS для доверенных источников
  - [ ] Rate limiting по IP
  - [ ] Ограничение размера тела запроса
- **Зависимости**: «Реализовать API POST /generate-pdf»

## Задача: Frontend форма и интеграция с API
- **Статус**: Не начата
- **Приоритет**: Средний
- **Описание**: HTML/JS форма, отправка данных на бэкенд, загрузка PDF.
- **Шаги выполнения**:
  - [ ] Создать форму с полями dailyConsumption, pumpModel, projectCode
  - [ ] Кнопки «Рассчитать», «Сгенерировать PDF»
  - [ ] Валидация на клиенте
  - [ ] Интеграция с /generate-pdf и загрузка файла
- **Зависимости**: «Реализовать API POST /generate-pdf»

## Задача: Логирование и обработка ошибок
- **Статус**: Не начата
- **Приоритет**: Средний
- **Описание**: Единый формат ошибок, уровни логирования, трассировка проблем.
- **Шаги выполнения**:
  - [ ] Ввести middleware обработки ошибок
  - [ ] Формат { code, message, details? }
  - [ ] Логирование info/warn/error
- **Зависимости**: «Реализовать API POST /generate-pdf»

## Задача: Тестирование (unit + integration)
- **Статус**: Не начата
- **Приоритет**: Высокий
- **Описание**: Покрыть расчёты, рендер PDF и E2E.
- **Шаги выполнения**:
  - [ ] Юнит‑тесты функций расчёта
  - [ ] Тесты маппинга координат и рендера текста
  - [ ] Интеграционный тест /generate-pdf
- **Зависимости**: «Реализовать модуль расчётов», «Заполнение PDF относительно меток», «Реализовать API POST /generate-pdf»

## Задача: Настроить линтеры и pre-commit hooks
- **Статус**: Не начата
- **Приоритет**: Средний
- **Описание**: Единый стиль кода, предотвращение мусора в репозитории.
- **Шаги выполнения**:
  - [ ] ESLint + Prettier конфигурация
  - [ ] Husky + lint-staged pre-commit
- **Зависимости**: нет

## Задача: Настроить переменные окружения и конфигурацию
- **Статус**: Не начата
- **Приоритет**: Средний
- **Описание**: Параметризация порта, CORS, rate limit, локали.
- **Шаги выполнения**:
  - [ ] .env и загрузка конфигурации
  - [ ] Документация параметров в Project.md
- **Зависимости**: нет

## Задача: Подготовить деплой (production)
- **Статус**: Не начата
- **Приоритет**: Низкий
- **Описание**: PM2, переменные окружения, документация запуска.
- **Шаги выполнения**:
  - [ ] PM2/ecosystem.config.js
  - [ ] Гайд по деплою в README
- **Зависимости**: «Безопасность и ограничения», «Реализовать API POST /generate-pdf»
