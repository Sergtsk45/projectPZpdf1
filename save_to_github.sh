#!/bin/bash

echo "üîÑ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ç–∫—É GitHub..."

# –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
echo "üìÅ –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã..."
git add .

# –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç
echo "üíæ –°–æ–∑–¥–∞–µ–º –∫–æ–º–º–∏—Ç..."
git commit -m "fix: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ multer –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤

- –ò–∑–º–µ–Ω–µ–Ω filename –≤ multer —Å template_<timestamp> –Ω–∞ temp_<timestamp>
- –¢–µ–ø–µ—Ä—å —Ñ–∞–π–ª—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—é—Ç—Å—è –≤ template_<templateId>.pdf
- –£–ª—É—á—à–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ fallback –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ —à–∞–±–ª–æ–Ω–æ–≤
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –≤—ã–±–æ—Ä–æ–º —Ñ–∞–π–ª–∞ —à–∞–±–ª–æ–Ω–∞"

# –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ main –≤–µ—Ç–∫—É
echo "üîÑ –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ main –≤–µ—Ç–∫—É..."
git checkout main

# –ú–µ—Ä–∂–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ —Ç–µ–∫—É—â–µ–π –≤–µ—Ç–∫–∏
echo "üîÄ –ú–µ—Ä–∂–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è..."
git merge --no-ff -

# –ü—É—à–∏–º –≤ –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ç–∫—É
echo "‚¨ÜÔ∏è –ü—É—à–∏–º –≤ –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ç–∫—É..."
git push origin main

# –£–¥–∞–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –≤–µ—Ç–∫–∏ (–∫—Ä–æ–º–µ main)
echo "üóëÔ∏è –£–¥–∞–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –≤–µ—Ç–∫–∏..."
git branch | grep -v "main" | xargs -r git branch -D

# –£–¥–∞–ª—è–µ–º —É–¥–∞–ª–µ–Ω–Ω—ã–µ –≤–µ—Ç–∫–∏
echo "üóëÔ∏è –£–¥–∞–ª—è–µ–º —É–¥–∞–ª–µ–Ω–Ω—ã–µ –≤–µ—Ç–∫–∏..."
git branch -r | grep -v "main" | sed 's/origin\///' | xargs -r git push origin --delete

echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ç–∫—É main"
